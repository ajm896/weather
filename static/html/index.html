<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Minimal API Demo</title>
</head>

<body>
    <!-- 1. Container for your data -->
    <h1>Weather Data</h1>
    <div id="output">Loading…</div>

    <!-- 2. Inline script to fetch, parse, display -->
    <script>
        // replace with your real endpoint
        const API_URL = 'http://127.0.0.1:8000/api/weather';

        fetch(API_URL)
            .then(res => {
                if (!res.ok) throw new Error(res.statusText);
                return res.text(); // Get as text first
            })
            .then(textData => {
                // Parse JSON manually to handle potential string responses
                let data;
                try {
                    data = typeof textData === 'string' ? JSON.parse(textData) : textData;
                } catch (e) {
                    throw new Error('Invalid JSON response');
                }

                // find the container…
                const out = document.getElementById('output');

                // Clear loading message
                out.innerHTML = '';

                // Access the periods array from weatherData
                let forecast = data.weatherData?.periods;

                if (Array.isArray(forecast)) {
                    forecast.forEach((f, index) => {
                        console.log('Period:', f);
                        const el = document.createElement('div');
                        el.id = 'period_' + index;
                        el.textContent = f.name + ': ' + f.temperature + '°F';
                        out.appendChild(el);
                    });
                } else {
                    // If not an array, display the raw data for debugging
                    out.textContent = JSON.stringify(data, null, 2);
                }
            })
            .catch(err => {
                document.getElementById('output').textContent =
                    'Error: ' + err.message;
                console.error(err);
            });
    </script>
</body>

</html>